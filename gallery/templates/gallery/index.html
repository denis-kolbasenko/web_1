{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>3D Storage</title>
    <!-- 1 —à–∞–≥ –≤ 7 –ª–∞–±–µ -->
    <!-- –í–ê–ñ–ù–û: –≠—Ç–æ –∫–∞—Ä—Ç–∞, —É–∫–∞–∑—ã–≤–∞—é—â–∞—è –±—Ä–∞—É–∑–µ—Ä—É, –≥–¥–µ –±—Ä–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CSS (–æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –±—ã–ª–æ) -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'gallery/style.css' %}">
</head>
<body>
    <header>
        <h1>{{ page_title }}</h1>
        <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —Ç–µ–ø–µ—Ä—å –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∫–Ω–æ–ø–∫–∞ -->
        <a href="{% url 'upload' %}" class="btn" style="background-color: #28a745;">+ –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å</a>
    </header>
    <main>
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–µ—Ç–∫–∏ -->
        <div class="gallery-grid">
            {% for asset in assets %}
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ -->
                <div class="asset-card">
                    <!-- 1. –ü—Ä–µ–≤—å—é (–í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å) -->
                    <!-- –î–æ–±–∞–≤–ª—è–µ–º ID –∏ data-url.
id="model-container-..." –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã JS –Ω–∞—à–µ–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π div.
data-url="..." —Ö—Ä–∞–Ω–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—É—é JS –ø—Ä–æ—á–∏—Ç–∞–µ—Ç.-->
                    <!-- –ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ —Å–µ—Ä—ã–π –∫–≤–∞–¥—Ä–∞—Ç —Å –∏–∫–æ–Ω–∫–æ–π –∫—É–±–∞ -->
                    <!-- –ù–∞ 6-–π –Ω–µ–¥–µ–ª–µ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∞, –Ω–∞ 5-–π - 3D —Å—Ü–µ–Ω–∞ -->
                    <div class="card-preview" 
                         id="model-container-{{ asset.id }}"
                         data-url="{{ asset.file.url }}">
                        <!-- –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–≤–∏–º —Ç–µ–∫—Å—Ç, –ø–æ–∫–∞ JS –Ω–µ –∑–∞–º–µ–Ω–∏—Ç –µ–≥–æ –Ω–∞ Canvas -->üé≤
                    </div>
                    <!-- 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å) -->
                    <div class="card-info">
                        <h3 class="card-title">{{ asset.title }}</h3>
                        <div class="card-meta">
                            <span>üìÖ {{ asset.created_at|date:"d M Y" }}</span>
                            <!-- –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä -->
                            {% if asset.file %}
                                <span style="float: right;">üíæ {{ asset.file.size|filesizeformat }}</span>
                            {% endif %}
                        </div>
                        <!-- –ö–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è -->
                        {% if asset.file %}
                            <a href="{{ asset.file.url }}" class="btn" download>–°–∫–∞—á–∞—Ç—å .glb</a>
                        {% else %}
                            <span style="color: red;">–§–∞–π–ª –ø–æ—Ç–µ—Ä—è–Ω</span>
                        {% endif %}
                    </div>
                </div>
            {% empty %}
                <p>–ë–∞–∑–∞ –ø—É—Å—Ç–∞.</p>
            {% endfor %}
        </div>
    </main>
    <footer>
        <p>&copy; 2024 Web Structures Course</p>
    </footer>
    <!-- 3 —à–∞–≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –≤ –®–∞–±–ª–æ–Ω –≤ 7 –ª–∞–±–µ -->
    <!-- index.html (–≤–Ω–∏–∑—É) -->
    <!-- type="module" –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ -->
    <script type="module">
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é. 
        // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –ø—É—Ç—å –∫ JS —á–µ—Ä–µ–∑ static
        import { mountSimpleCube } from "{% static 'gallery/js/viewer.js' %}";
        // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–∞—Ä—Ç–æ—á–µ–∫
        const containers = document.querySelectorAll('.card-preview');
        if (containers.length > 0) {
            // –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∞
            const firstContainer = containers[0];
            // –ü–æ–ª—É—á–∞–µ–º –µ–≥–æ ID (–º—ã –∑–∞–¥–∞–ª–∏ –µ–≥–æ –Ω–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ: model-container-{{ asset.id }})
            const containerId = firstContainer.id;
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º–∞–≥–∏—é
            mountSimpleCube(containerId);
        }
    </script>
</body>
</html>
